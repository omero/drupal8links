"use strict";angular.module("drupal8linksApp",["ui.router","ngTagsInput"]).config(["$stateProvider","$urlRouterProvider","$httpProvider",function(a,b,c){c.defaults.useXDomain=!0,c.defaults.withCredentials=!0,delete c.defaults.headers.common["X-Requested-With"],c.defaults.headers.common.Accept="application/json",c.defaults.headers.common["Content-Type"]="application/json",c.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded";a.state("home",{url:"",views:{"":{templateUrl:"views/home.html"},"sidebar@home":{controller:"CategoriesListCtrl",templateUrl:"views/sidebar.html"},"content@home":{controller:"LinksCtrl",templateUrl:"views/content.html"}}}).state("home.detail",{url:"/:categoryName",views:{"content@home":{controller:"LinksDetailCtrl",templateUrl:"views/content.html"}}}).state("login",{url:"/user/login",controller:"LoginCtrl",templateUrl:"views/login.html"}).state("add",{url:"/link/add",controller:"addLinkCtrl",templateUrl:"views/addlink.html"}),b.otherwise("home")}]).run(["$rootScope","$location",function(a){a.$on("$routeChangeSuccess",function(a){console.log(a)}),a.$on("$routeChangeError",function(a,b,c,d){d.authenticated===!1&&console.log("not logged")})}]),angular.module("drupal8linksApp").factory("linkSvc",function(){return{link:function(a,b,c,d){return{node:{type:"link",field_tags:{und:b},title:a,body:{und:[{value:c}]},field_link:{und:[{url:d}]}}}}}}),angular.module("drupal8linksApp").controller("CategoriesListCtrl",["$scope","$http","resourcesSvc",function(a,b,c){b.get(c.resources.categories).success(function(b){a.categories=b})}]),angular.module("drupal8linksApp").controller("LinksCtrl",["$scope","$http","$stateParams","resourcesSvc",function(a,b,c,d){b.get(d.resources.links).success(function(b){a.links=b})}]).controller("LinksDetailCtrl",["$scope","$http","$stateParams","resourcesSvc",function(a,b,c,d){console.log(c.categoryName),b.get(d.resources.links+"?args[0]="+c.categoryName).success(function(b){a.links=b})}]),angular.module("drupal8linksApp").factory("authenticationSvc",["$http","$q","$window","resourcesSvc","$state",function(a,b,c,d,e){function f(f,g){var h=$.param({username:f,password:g}),i=b.defer();return a.post(d.resources.login,h).then(function(a){j={session_name:a.data.session_name,sessid:a.data.sessid,token:a.data.token,user:a.data.user},c.sessionStorage.userInfo=JSON.stringify(j),i.resolve(j),e.go("home")},function(a){i.reject(a)}),i.promise}function g(){console.log(j);var e=b.defer();a({method:"POST",url:d.resources.logout,headers:{"X-CSRF-Token":j.token}}).then(function(){console.log("logoff"),c.location.reload(),c.sessionStorage.userInfo=null,j=null,e.resolve(j)},function(a){e.reject(a)})}function h(){return j}function i(){c.sessionStorage.userInfo&&(j=JSON.parse(c.sessionStorage.userInfo))}var j;return i(),{login:f,logout:g,getUserInfo:h}}]),angular.module("drupal8linksApp").factory("resourcesSvc",function(){return{resources:{connect:"http://dev-links-drupal-7.pantheon.io/api/system/connect",login:"http://dev-links-drupal-7.pantheon.io/api/user/login",logout:"http://dev-links-drupal-7.pantheon.io/api/user/logout",categories:"http://dev-links-drupal-7.pantheon.io/api/views/categories_links",links:"http://dev-links-drupal-7.pantheon.io/api/views/links",node:"http://dev-links-drupal-7.pantheon.io/api/node"}}}),angular.module("drupal8linksApp").controller("LoginCtrl",["$scope","authenticationSvc","$state",function(a,b,c){a.user={name:"",password:""},a.login=function(){b.login(a.user.name,a.user.password),c.forceReload()}}]),angular.module("drupal8linksApp").controller("MenuCtrl",["$scope","authenticationSvc",function(a,b){a.$watch(b.getUserInfo,function(){a.userInfo=b.getUserInfo(),a.user=a.userInfo.user,a.token=a.userInfo.token}),a.logout=function(){b.logout()}}]),angular.module("drupal8linksApp").controller("addLinkCtrl",["$scope","$http","$state","resourcesSvc","authenticationSvc","linkSvc",function(a,b,c,d,e,f){function g(a,b){for(var c=[],d=0;d<a.length;++d)c.push(a[d][b]);return c}a.$watch(e.getUserInfo,function(){a.userInfo=e.getUserInfo(),a.token=a.userInfo.token}),a.form={title:"",tags:"",body:"",url:""},a.addLink=function(){var c=g(a.form.tags,"text");c=c.join();var e=f.link(a.form.title,c,a.form.body,a.form.url),h=$.param(e);b({method:"POST",url:d.resources.node,headers:{"X-CSRF-Token":a.token},data:h}).then(function(){a.msg="Link Capurado :D"},function(){a.error="No se pudo u_u"})}}]);